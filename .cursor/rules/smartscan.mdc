---
alwaysApply: false
---
# ğŸ” @smartscan.mdc â€“ ADVANCED PROJECT ANALYZER & STRUCTURE OPTIMIZER

## TRIGGER COMMANDS:
- `@smartscan.mdc` â†’ Full project analysis
- `@smartscan.mdc quick` â†’ Fast overview scan  
- `@smartscan.mdc deep` â†’ Deep dependency analysis
- `@smartscan.mdc structure` â†’ Generate restructure recommendations
- `@smartscan.mdc security` â†’ Security & best practices audit
- `@smartscan.mdc performance` â†’ Performance bottleneck analysis

---

## ğŸ¯ EXECUTION FLOW:

### 1. INITIALIZATION
When triggered, immediately:
1. **SCAN** all uploaded/pasted files recursively
2. **ANALYZE** file extensions, imports, exports, function calls
3. **CREATE** organized folder structure: `analysis/`
4. **GENERATE** multiple output files based on scan type

### 2. FOLDER STRUCTURE CREATED:
```
analysis/
â”œâ”€â”€ scan_overview.md          # Main project map
â”œâ”€â”€ dependency_graph.md       # Import/export relationships  
â”œâ”€â”€ code_quality_report.md    # Issues & improvements
â”œâ”€â”€ restructure_plan.md       # Suggested new organization
â”œâ”€â”€ function_inventory.md     # All functions & their usage
â””â”€â”€ security_audit.md        # Security concerns & fixes
```

---

## ğŸ“‹ OUTPUT FORMATS:

### ğŸ—ºï¸ **scan_overview.md** (Always Generated)
```markdown
# ğŸ“Š PROJECT ANALYSIS REPORT
*Generated on: [timestamp]*
*Files Analyzed: [count] | Languages: [list]*

## ğŸ—ï¸ ARCHITECTURE OVERVIEW
### Core Features Identified:
- **Authentication System** (5 files)
  - `/auth/login.js` â†’ JWT token generation
  - `/middleware/auth.js` â†’ Route protection
  - `/utils/hash.js` â†’ Password encryption
  - Status: âœ… Well structured | âš ï¸ Missing validation | âŒ Security issues

- **User Management** (8 files)  
  - Primary: `/controllers/userController.js`
  - Routes: `/routes/users.js`
  - Models: `/models/User.js`
  - Status: âš ï¸ Scattered logic across multiple files

### ğŸ¯ FEATURE COMPLETENESS:
- âœ… **Complete Features**: Authentication, User CRUD
- âš ï¸ **Partial Features**: Email system (missing templates)
- âŒ **Broken Features**: Password reset (missing endpoints)
- ğŸ”„ **Duplicated Logic**: User validation in 4 different files

### ğŸ“ DIRECTORY HEALTH:
- **Well Organized**: `/models/`, `/config/`
- **Needs Attention**: `/utils/` (mixed purposes), `/helpers/` (unclear naming)  
- **Orphaned Files**: `temp.js`, `backup_old.js`, `test123.html`
- **Missing Standard Dirs**: `/tests/`, `/docs/`, `/services/`

### ğŸ”— DEPENDENCY WEB:
- **High Coupling**: UserController â†’ 12 different files
- **Circular Dependencies**: auth.js â†” userController.js  
- **Unused Dependencies**: lodash (installed but never imported)
- **Missing Dependencies**: express-validator (used but not in package.json)
```

### ğŸ§¬ **dependency_graph.md** (For Deep Scans)
```markdown
# ğŸ•¸ï¸ DEPENDENCY RELATIONSHIP MAP

## ğŸ“ˆ DEPENDENCY FLOW DIAGRAM
```
[Core App] 
    â”œâ”€â”€ AuthController
    â”‚   â”œâ”€â”€ bcrypt âœ…
    â”‚   â”œâ”€â”€ jsonwebtoken âœ…  
    â”‚   â””â”€â”€ User Model âœ…
    â”œâ”€â”€ UserController âš ï¸
    â”‚   â”œâ”€â”€ User Model âœ…
    â”‚   â”œâ”€â”€ EmailService âŒ (missing)
    â”‚   â””â”€â”€ ValidationUtils âš ï¸ (duplicated)
```

## ğŸ”„ CIRCULAR DEPENDENCIES (Critical Issues):
1. **auth.js â†” userController.js**
   - Fix: Move shared logic to `/services/authService.js`
2. **routes/index.js â†” middleware/logging.js**  
   - Fix: Use dependency injection pattern

## ğŸ§© FUNCTION CROSS-REFERENCE:
### validateUser()
- **Defined**: `/utils/validation.js:15`
- **Called by**: 
  - `/controllers/userController.js:45` 
  - `/routes/auth.js:23`
  - `/middleware/validation.js:8` âš ï¸ (duplicate implementation)
- **Recommendation**: Consolidate into single source of truth
```

### ğŸ”§ **code_quality_report.md** (For Quality Focus)
```markdown
# ğŸ“‹ CODE QUALITY & TECHNICAL DEBT ANALYSIS

## ğŸš¨ CRITICAL ISSUES:
### Security Vulnerabilities:
- âŒ **SQL Injection Risk**: `/controllers/userController.js:78` - Direct string concatenation
- âŒ **XSS Vulnerability**: `/views/profile.html:45` - Unescaped user input  
- âŒ **Hardcoded Secrets**: `/config/database.js:12` - Password in plain text

### Performance Bottlenecks:  
- ğŸŒ **N+1 Query Problem**: `/controllers/posts.js:34` - Loading users in loop
- ğŸŒ **Missing Indexes**: User table queries without proper indexing
- ğŸŒ **Large Bundle Size**: Unused imports increasing build size by 40%

## âš ï¸ CODE SMELLS:
### Structural Issues:
- **God Object**: `UserController.js` (847 lines, 23 methods)
- **Dead Code**: 15 functions never called
- **Magic Numbers**: Hardcoded values throughout codebase  
- **Inconsistent Naming**: camelCase mixed with snake_case

### Maintainability Concerns:
- **No Error Handling**: 60% of functions lack try-catch
- **Missing Documentation**: 0 JSDoc comments found
- **Outdated Dependencies**: 8 packages with security vulnerabilities

## ğŸ“Š METRICS:
- **Complexity Score**: 7.8/10 (High)
- **Test Coverage**: 12% (Very Low)  
- **Documentation**: 5% (Minimal)
- **Code Duplication**: 23% (High)
```

### ğŸ—ï¸ **restructure_plan.md** (Restructuring Suggestions)
```markdown
# ğŸ—ï¸ RECOMMENDED PROJECT RESTRUCTURE

## ğŸ¯ CURRENT VS PROPOSED STRUCTURE:

### âŒ Current (Problematic):
```
/
â”œâ”€â”€ utils/ (mixed utilities)
â”œâ”€â”€ helpers/ (unclear purpose)  
â”œâ”€â”€ auth.js (single file doing everything)
â”œâ”€â”€ userStuff.js (vague naming)
â””â”€â”€ temp_files/ (development debris)
```

### âœ… Proposed (Clean Architecture):
```
/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/     # Request handlers only
â”‚   â”œâ”€â”€ services/        # Business logic
â”‚   â”œâ”€â”€ models/          # Data models
â”‚   â”œâ”€â”€ middleware/      # Express middleware
â”‚   â”œâ”€â”€ routes/          # Route definitions
â”‚   â”œâ”€â”€ utils/           # Pure utility functions
â”‚   â”œâ”€â”€ config/          # Configuration files
â”‚   â””â”€â”€ validators/      # Input validation schemas
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e/
â”œâ”€â”€ docs/
â””â”€â”€ scripts/
```

## ğŸ“‹ MIGRATION PLAN:

### Phase 1: Critical Restructuring (Week 1)
1. **Extract Services**: Move business logic from controllers
   - Create `/services/userService.js` 
   - Create `/services/authService.js`
   - Create `/services/emailService.js`

2. **Consolidate Utilities**: 
   - Merge `/utils/` and `/helpers/` into organized `/utils/`
   - Group by purpose: validation, formatting, crypto, etc.

3. **Fix Circular Dependencies**:
   - Implement dependency injection
   - Create service interfaces

### Phase 2: Quality Improvements (Week 2)  
1. **Add Input Validation**: Implement joi or yup schemas
2. **Error Handling**: Centralized error handling middleware
3. **Security Hardening**: Fix identified vulnerabilities
4. **Add Tests**: Start with critical path coverage

### Phase 3: Optimization (Week 3)
1. **Performance**: Fix N+1 queries, add caching
2. **Documentation**: Add JSDoc comments  
3. **CI/CD**: Set up automated testing and deployment

## ğŸ”§ AUTOMATED REFACTORING COMMANDS:
```bash
# These commands can be run to auto-restructure:
mkdir -p src/{controllers,services,models,middleware,routes,utils,config,validators}
mkdir -p tests/{unit,integration,e2e}
mkdir -p docs scripts

# Move files (examples):
mv userController.js src/controllers/
mv authUtils.js src/services/authService.js
mv validation.js src/validators/
```
```

---

## ğŸ”„ ENHANCED FEATURES:

### 1. SMART PATTERN RECOGNITION:
- **Framework Detection**: Automatically detect React, Vue, Express, etc.
- **Architecture Pattern**: Identify MVC, Clean Architecture, microservices
- **Database Pattern**: Detect ORM usage, query patterns

### 2. INTELLIGENT SUGGESTIONS:
```markdown
## ğŸ’¡ SMART RECOMMENDATIONS:

### Based on your Express.js + MongoDB stack:
1. **Add Request Validation**: Use `express-validator` for input sanitization
2. **Implement Rate Limiting**: Add `express-rate-limit` for API protection  
3. **Database Optimization**: Add indexes for frequently queried fields
4. **Error Handling**: Implement centralized error handling middleware
5. **Logging**: Add structured logging with `winston`

### Missing Best Practices:
- âŒ No environment variable validation
- âŒ No API documentation (consider Swagger)
- âŒ No database migration system  
- âŒ No monitoring/health checks
```

### 3. CONTEXT-AWARE ANALYSIS:
- **Language-Specific**: Different analysis for JS, Python, Java, etc.
- **Framework-Aware**: Tailored suggestions for detected frameworks
- **Scale-Aware**: Different advice for small projects vs enterprise applications

### 4. INTERACTIVE COMMANDS:
```markdown
## ğŸ® FOLLOW-UP COMMANDS:
After initial scan, use these for deeper analysis:

- `@smartscan.focus [filename]` â†’ Deep dive into specific file
- `@smartscan.trace [function]` â†’ Follow function usage across codebase  
- `@smartscan.compare` â†’ Compare with industry best practices
- `@smartscan.export` â†’ Generate refactoring scripts
- `@smartscan.monitor` â†’ Set up file change monitoring
```

---

## âœ… COMPLETION MESSAGE TEMPLATE:
```
ğŸ‰ **ANALYSIS COMPLETE!** 

ğŸ“Š **Summary**: [X] files analyzed, [Y] issues found, [Z] improvements suggested
ğŸ“ **Results saved to**: `analysis/` folder
ğŸ¯ **Priority**: Fix [critical_count] critical issues first
â±ï¸ **Estimated fix time**: [time_estimate]

ğŸš€ **Quick Actions**:
- Type `@smartscan.focus [filename]` for detailed file analysis
- Type `@smartscan.structure` to see restructuring plan  
- Type `@smartscan.export` to generate refactoring scripts

ğŸ’¡ **Top 3 Recommendations**:
1. [Most important fix]
2. [Second priority] 
3. [Third priority]
```

---

## ğŸ”§ CUSTOMIZATION OPTIONS:

### Configuration Variables:
```javascript
// Add to cursor settings:
{
  "smartscan.depth": "deep|normal|quick",
  "smartscan.focus": "security|performance|structure|all",
  "smartscan.framework": "auto|express|react|vue|angular",
  "smartscan.outputFormat": "markdown|json|html",
  "smartscan.autoFix": true|false
}
```

This enhanced rule transforms a simple scanner into a comprehensive code analysis and refactoring assistant that can handle even the messiest codebases!