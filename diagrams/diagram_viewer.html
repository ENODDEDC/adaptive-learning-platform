<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        h1, h2 { text-align: center; }
        .diagram-container {
            border: 1px solid #ccc;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>Project Diagrams</h1>

    <div class="diagram-container">
        <h2>Entity-Relationship Diagram (ERD)</h2>
        <div class="mermaid">
erDiagram
    USER ||--o{ COURSE : "creates"
    USER ||--o{ COURSE : "enrolls"
    USER ||--o{ SUBMISSION : "submits"
    USER ||--o{ ASSIGNMENT : "posts"
    USER ||--o{ ANNOUNCEMENT : "posts"
    USER ||--o{ COMMENT : "posts"
    USER ||--o{ CONTENT : "uploads"
    USER ||--o{ NOTE : "creates"
    USER ||--o{ ACTIVITY : "performs"
    USER ||--o{ ADAPTIVE_PREFERENCES : "has"
    USER ||--o{ USER_BEHAVIOR : "exhibits"
    USER ||--o{ SCHEDULED_COURSE : "schedules"
    USER ||--o{ FORM : "creates"
    USER ||--o{ FORM : "responds to"
    
    COURSE ||--|{ CONTENT : "has"
    COURSE ||--|{ ASSIGNMENT : "has"
    COURSE ||--|{ ANNOUNCEMENT : "has"
    COURSE ||--|{ FORM : "has"
    COURSE ||--o{ CLUSTER : "belongs to"
    
    ASSIGNMENT ||--|{ SUBMISSION : "receives"
    ASSIGNMENT ||--o{ CONTENT : "attaches"
    ASSIGNMENT ||--o{ COMMENT : "has"
    
    ANNOUNCEMENT ||--o{ CONTENT : "attaches"
    ANNOUNCEMENT ||--o{ COMMENT : "has"
    
    SUBMISSION ||--o{ CONTENT : "attaches"
    
    CLUSTER ||--o{ COURSE : "contains"
    
    USER {
        string name
        string middleName
        string surname
        string suffix
        string email
        string password
        string otp
        date otpExpires
        boolean isVerified
        string resetPasswordToken
        date resetPasswordExpires
        string googleId
        string photoURL
        string authProvider
        string role
    }
    
    COURSE {
        string subject
        string section
        string teacherName
        string coverColor
        string uniqueKey
        ObjectId createdBy
    }
    
    CONTENT {
        ObjectId courseId
        string title
        string description
        string filename
        string originalName
        string filePath
        string contentType
        number fileSize
        string mimeType
        ObjectId uploadedBy
        boolean isActive
        string thumbnailUrl
    }
    
    ASSIGNMENT {
        ObjectId courseId
        string title
        string description
        date dueDate
        ObjectId postedBy
        string type
        ObjectId topic
    }
    
    SUBMISSION {
        ObjectId assignmentId
        ObjectId studentId
        string content
        string status
        date submittedAt
        date lastModified
        number workSessionTime
        number progress
        number grade
        ObjectId gradedBy
        date gradedAt
        string feedback
    }
    
    ACTIVITY {
        ObjectId user
        string action
        string targetType
        ObjectId targetId
        string targetName
        string description
        object metadata
        string ipAddress
        string userAgent
        string type
        string category
    }
    
    ADAPTIVE_PREFERENCES {
        ObjectId userId
        object layoutPreferences
        object interactionPatterns
        object adaptiveSettings
        date lastAdaptation
        number version
        object syncStatus
    }
    
    ANNOUNCEMENT {
        ObjectId courseId
        string content
        ObjectId postedBy
        boolean pinned
    }
    
    CLUSTER {
        string name
        string section
        string classCode
        ObjectId createdBy
        string coverColor
        string description
        boolean isPublic
        boolean allowJoin
        boolean archived
        date archivedAt
    }
    
    COMMENT {
        string content
        ObjectId postedBy
        ObjectId onItem
        string onModel
    }
    
    FORM {
        string title
        string description
        array questions
        string type
        ObjectId courseId
        ObjectId createdBy
        boolean isActive
        object settings
    }
    
    NOTE {
        string contentId
        ObjectId courseId
        ObjectId userId
        string type
        string content
        string contextualText
        string contextualId
        object position
        object size
        object style
        boolean isShared
        string visibility
        string category
        array tags
        string priority
        boolean isArchived
        ObjectId lastEditedBy
        number version
    }
    
    NOTIFICATION {
        ObjectId recipient
        ObjectId sender
        ObjectId course
        string type
        string message
        string link
        boolean read
    }
    
    SCHEDULED_COURSE {
        ObjectId userId
        ObjectId courseId
        string day
        string timeSlot
    }
    
    USER_BEHAVIOR {
        ObjectId userId
        string sessionId
        string interactionType
        object details
        date timestamp
        object deviceInfo
        object metadata
    }
        </div>
    </div>

    <div class="diagram-container">
        <h2>System Architecture Diagram</h2>
        <div class="mermaid">
graph TD
    subgraph "Client-Side (Next.js)"
        A[Browser] --> B{Next.js Frontend};
        B --> C[React Components];
        B --> D[API Calls];
    end

    subgraph "Server-Side (Next.js API Routes)"
        D --> E{API Routes};
        E --> F[Authentication];
        E --> G[Business Logic];
        E --> H[Database Interaction];
    end

    subgraph "Database (MongoDB)"
        H --> I[MongoDB Atlas];
    end

    subgraph "External Services"
        G --> J[Backblaze B2];
        G --> K[Firebase];
    end

    style B fill:#f9f,stroke:#333,stroke-width:2px;
    style E fill:#ccf,stroke:#333,stroke-width:2px;
    style I fill:#cfc,stroke:#333,stroke-width:2px;
    style J fill:#fcf,stroke:#333,stroke-width:2px;
    style K fill:#fcf,stroke:#333,stroke-width:2px;
        </div>
    </div>

    <div class="diagram-container">
        <h2>User Registration & Login Flow</h2>
        <div class="mermaid">
graph TD
    A[Start] --> B{User visits login page};
    B --> C{Has an account?};
    C -- Yes --> D[Enters credentials];
    C -- No --> E[Clicks 'Register'];
    
    E --> F[Fills registration form];
    F --> G{Submits form};
    G --> H[Server validates data];
    H -- Valid --> I[Creates new user];
    H -- Invalid --> F;
    I --> J[Sends verification email];
    J --> K[User verifies email];
    K --> D;
    
    D --> L{Submits credentials};
    L --> M[Server authenticates];
    M -- Success --> N[Redirects to dashboard];
    M -- Failure --> D;
    N --> O[End];
        </div>
    </div>

    <div class="diagram-container">
        <h2>Assignment Submission Data Flow</h2>
        <div class="mermaid">
graph TD
    subgraph "Student"
        A[Student fills out assignment] --> B{Submits assignment};
    end

    subgraph "System"
        B --> C[API endpoint receives submission];
        C --> D{Validate submission data};
        D -- Valid --> E[Save submission to database];
        D -- Invalid --> F[Return error to student];
        E --> G[Upload attachments to Backblaze B2];
        G --> H[Update submission with attachment URLs];
        H --> I[Notify instructor];
    end

    subgraph "Data Stores"
        E --> J(Submissions);
        G --> K(Backblaze B2);
        H --> J;
    end

    subgraph "Instructor"
        I --> L[Instructor receives notification];
    end
        </div>
    </div>

    <div class="diagram-container">
        <h2>Course Enrollment Flow</h2>
        <div class="mermaid">
graph TD
    A[Start] --> B{Student is logged in};
    B --> C[Student navigates to 'Courses' page];
    C --> D{Chooses to join a course};
    D --> E[Enters the unique course key/code];
    E --> F{System validates the key};
    F -- Valid Key --> G[System enrolls student in the course];
    G --> H[Student is added to the course's 'enrolledUsers' list];
    H --> I[Student is redirected to the course page];
    I --> J[Success message is displayed];
    J --> K[End];
    F -- Invalid Key --> L[Error message is displayed];
    L --> E;
        </div>
    </div>

    <div class="diagram-container">
        <h2>Content Upload Flow</h2>
        <div class="mermaid">
graph TD
    A[Start] --> B{Instructor is logged in and on a course page};
    B --> C[Clicks 'Upload Content'];
    C --> D{Selects file(s) to upload};
    D --> E[Enters title and description for the content];
    E --> F{Submits the upload form};
    F --> G[API endpoint receives the request];
    G --> H{System processes the file};
    H --> I[File is uploaded to Backblaze B2];
    I --> J[A new 'Content' document is created in the database];
    J --> K[Thumbnail is generated for the content];
    K --> L[System links the content to the course];
    L --> M[Success message is displayed];
    M --> N[End];
    H -- Upload Fails --> O[Error message is displayed];
    O --> C;
        </div>
    </div>

    <div class="diagram-container">
        <h2>Full Assignment Cycle Flow</h2>
        <div class="mermaid">
graph TD
    subgraph Instructor
        A[Start] --> B{Creates a new assignment};
        B --> C[Sets title, description, due date, and attaches files];
        C --> D{Publishes the assignment};
    end

    subgraph System
        D --> E[A new 'Assignment' document is created in the database];
        E --> F[Notifications are sent to enrolled students];
    end

    subgraph Student
        F --> G{Student receives notification and views the assignment};
        G --> H[Student works on the assignment];
        H --> I{Submits the assignment with attachments};
    end

    subgraph System
        I --> J[A new 'Submission' document is created in the database];
        J --> K[Files are uploaded to Backblaze B2];
        K --> L[Notification is sent to the instructor];
    end

    subgraph Instructor
        L --> M{Instructor receives submission notification};
        M --> N[Instructor reviews the submission];
        N --> O{Grades the submission and provides feedback};
        O --> P[Updates the 'Submission' document with the grade];
    end
    
    subgraph System
        P --> Q[Notification with grade and feedback is sent to the student];
    end

    subgraph Student
        Q --> R[Student views the grade and feedback];
        R --> S[End];
    end
        </div>
    </div>

    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
</body>
</html>